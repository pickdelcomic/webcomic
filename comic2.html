<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Deltarune-Style Battle UI Prototype</title>

<!-- Pixel font -->
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />

<style>
  /* Reset */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 0;
    background: #000;
    font-family: 'Press Start 2P', cursive;
    color: #fff;
    user-select: none;
  }

  /* Main container */
  #battle-container {
    max-width: 720px;
    margin: 20px auto;
    border: 4px solid #fff;
    background: #111;
    box-shadow: 0 0 0 4px #6600cc;
    position: relative;
    padding: 12px;
  }

  /* Battle area */
  #battle-area {
    background: #222;
    border: 2px solid #fff;
    height: 200px;
    position: relative;
    margin-bottom: 12px;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  /* Placeholder enemy sprite */
  #enemy-sprite {
    width: 96px;
    height: 96px;
    image-rendering: pixelated;
    background: url('https://i.imgur.com/jGXmnYI.png') center center no-repeat;
    background-size: contain;
    filter: drop-shadow(1px 1px 0 #6600cc);
  }

  /* Party menu */
  #party-menu {
    display: flex;
    gap: 12px;
    margin-bottom: 12px;
  }

  .party-member {
    border: 3px solid #fff;
    background: #000;
    padding: 6px;
    width: 160px;
    box-shadow: 2px 2px 0 #6600cc;
    cursor: pointer;
    transition: background 0.3s;
  }

  .party-member.selected {
    background: #6600cc;
  }

  .party-member img {
    width: 64px;
    height: 64px;
    image-rendering: pixelated;
    display: block;
    margin-bottom: 6px;
  }

  .party-member .name {
    font-size: 14px;
    text-align: center;
  }

  .party-member .hp-bar {
    background: #330044;
    height: 10px;
    margin-top: 6px;
    position: relative;
    border: 1px solid #fff;
  }

  .party-member .hp-fill {
    background: #00ff88;
    height: 100%;
    width: 100%;
  }

  /* Action menu */
  #action-menu {
    border: 3px solid #fff;
    background: #000;
    padding: 8px;
    box-shadow: 2px 2px 0 #6600cc;
    display: flex;
    justify-content: space-around;
  }

  .action-button {
    background: #111;
    border: 2px solid #fff;
    padding: 8px 12px;
    cursor: pointer;
    font-size: 12px;
    color: #fff;
    transition: background 0.2s;
    user-select: none;
  }

  .action-button:hover {
    background: #6600cc;
    color: #fff;
  }

  .action-button.disabled {
    opacity: 0.4;
    cursor: default;
  }

  /* Dialog box */
  #dialog-box {
    border: 4px solid #fff;
    background: #111;
    margin-top: 12px;
    padding: 10px;
    font-size: 14px;
    min-height: 40px;
    box-shadow: 0 0 0 4px #6600cc inset;
  }
</style>
</head>
<body>

<div id="battle-container">

  <div id="battle-area">
    <div id="enemy-sprite"></div>
  </div>

  <div id="party-menu">
    <!-- Party members injected by JS -->
  </div>

  <div id="action-menu">
    <!-- Action buttons injected by JS -->
  </div>

  <div id="dialog-box">
    Select an action to start the battle.
  </div>

</div>

<script>
  // Characters with their data and moves
  const party = [
    {
      name: 'Pomgrante',
      hp: 100,
      maxHp: 100,
      img: 'https://i.imgur.com/3xwL56R.png',
      role: 'attacker',
      moves: ['Attack', 'Special Attack']
    },
    {
      name: 'Potota',
      hp: 120,
      maxHp: 120,
      img: 'https://i.imgur.com/d6EqIcM.png',
      role: 'support',
      moves: ['Heal', 'Buff']
    },
    {
      name: 'Burger Shirt',
      hp: 80,
      maxHp: 80,
      img: 'https://i.imgur.com/bwVYrML.png',
      role: 'mercy',
      moves: ['Ask for Mercy']
    }
  ];

  let currentCharIndex = 0;
  let enemyHp = 200;
  let dialogBox = document.getElementById('dialog-box');

  const partyMenuDiv = document.getElementById('party-menu');
  const actionMenuDiv = document.getElementById('action-menu');
  const battleArea = document.getElementById('battle-area');

  // Render party UI
  function renderPartyMenu() {
    partyMenuDiv.innerHTML = '';
    party.forEach((char, i) => {
      const memberDiv = document.createElement('div');
      memberDiv.classList.add('party-member');
      if (i === currentCharIndex) memberDiv.classList.add('selected');
      memberDiv.innerHTML = `
        <img src="${char.img}" alt="${char.name}">
        <div class="name">${char.name}</div>
        <div class="hp-bar"><div class="hp-fill" style="width:${(char.hp / char.maxHp) * 100}%;"></div></div>
      `;
      memberDiv.addEventListener('click', () => {
        currentCharIndex = i;
        renderPartyMenu();
        renderActionMenu();
        setDialog(`You switched to ${char.name}.`);
      });
      partyMenuDiv.appendChild(memberDiv);
    });
  }

  // Render action menu based on selected character
  function renderActionMenu() {
    actionMenuDiv.innerHTML = '';
    const char = party[currentCharIndex];
    char.moves.forEach(move => {
      const btn = document.createElement('button');
      btn.classList.add('action-button');
      btn.textContent = move;

      // Disable unsupported moves for Burger Shirt except Ask for Mercy
      if (char.role === 'mercy' && move !== 'Ask for Mercy') {
        btn.classList.add('disabled');
        btn.disabled = true;
      }

      btn.addEventListener('click', () => {
        if (btn.disabled) return;
        handleAction(move);
      });

      actionMenuDiv.appendChild(btn);
    });
  }

  // Display dialog text
  function setDialog(text) {
    dialogBox.textContent = text;
  }

  // Mini-attack game placeholder (for Pomgrante's attack)
  function miniAttackGame(callback) {
    setDialog('Mini-game started! Press space quickly to attack!');
    // Simple timed mini-game simulation:
    let hits = 0;
    let maxHits = 5;
    function hit() {
      hits++;
      setDialog(`Hits: ${hits}/${maxHits}`);
      if (hits >= maxHits) {
        document.removeEventListener('keydown', onKeydown);
        callback(hits);
      }
    }
    function onKeydown(e) {
      if (e.code === 'Space') {
        hit();
      }
    }
    document.addEventListener('keydown', onKeydown);

    // Timeout in 5 seconds if user is slow
    setTimeout(() => {
      document.removeEventListener('keydown', onKeydown);
      setDialog(`Mini-game ended with ${hits} hits.`);
      callback(hits);
    }, 5000);
  }

  // Handle chosen action
  function handleAction(action) {
    const char = party[currentCharIndex];
    if (char.role === 'attacker' && action === 'Attack') {
      miniAttackGame((hits) => {
        let damage = hits * 10;
        enemyHp -= damage;
        if (enemyHp < 0) enemyHp = 0;
        setDialog(`${char.name} did ${damage} damage! Enemy HP: ${enemyHp}`);
        updateEnemyHpBar();
        if (enemyHp <= 0) {
          setDialog('Enemy defeated! You win!');
          disableActions();
        }
      });
    } else if (char.role === 'attacker' && action === 'Special Attack') {
      // Just a placeholder special
      enemyHp -= 50;
      if (enemyHp < 0) enemyHp = 0;
      setDialog(`${char.name} used Special Attack! Enemy HP: ${enemyHp}`);
      updateEnemyHpBar();
      if (enemyHp <= 0) {
        setDialog('Enemy defeated! You win!');
        disableActions();
      }
    } else if (char.role === 'support') {
      if (action === 'Heal') {
        char.hp += 30;
        if (char.hp > char.maxHp) char.hp = char.maxHp;
        setDialog(`${char.name} healed themselves! HP: ${char.hp}`);
        renderPartyMenu();
      } else if (action === 'Buff') {
        setDialog(`${char.name} buffs Pomgrante! (Effect placeholder)`);
      }
    } else if (char.role === 'mercy' && action === 'Ask for Mercy') {
      setDialog(`${char.name} asks for mercy... but it's not working.`);
    }
  }

  // Update enemy HP bar visually (optional)
  function updateEnemyHpBar() {
    // You could add a visible enemy HP bar here later
  }

  // Disable all action buttons on win
  function disableActions() {
    const buttons = document.querySelectorAll('.action-button');
    buttons.forEach(b => b.disabled = true);
  }

  // Initial render
  renderPartyMenu();
  renderActionMenu();

</script>

</body>
</html>
